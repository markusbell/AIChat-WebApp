

# LLMのモデルの違いによる回答の応答スピードと内容の違い
gptモデルの違いによる回答の応答スピードと回答内容を比較するため、Difyで作ったチャットボットでの実験結果をまとめます。<br>
Azureではgptモデルを変更してデバッグするのは手間がかかるので、Difyを使いました。Difyの環境は、PCにDocker Composeでデプロイしています。事例の26ファイルをナレッジとしてアップロードしています。<br>

実験に利用したプロンプトは下記です。

|No.|プロンプト|
|:--|:------|
|2|SharePoint Onlineの検索の事例を探してください|

26ファイルの中で、SharePointが出てくる事例は3つありますが、対象の事例は2つです。
<br>
<br>

## 1. 実験結果
チャンク設定は、最大チャンク長512、オーバーラップ128です。バイブリッド検索のリランクモデルはcohereのrerank-multilingual-v3.0を利用、top-kは３です。

### 1-1. 結果まとめ
gpt-4oが最も詳細な回答を作りました。<br>
簡潔な回答内容でもよければ、速度や料金から考えるとgpt-4o-miniを選択することも考えられそうです。

|モデル|gpt-4o|gpt-4o-mini|gpt-4|gpt-35-turbo|
|:----:|:-----:|:----------:|:----:|:------------:|
|時間|~6秒|~5秒|~8秒|~4秒|
|回答内容|2社記載<br>項目別に回答|2社記載<br>簡潔に回答|2社記載<br>簡潔に回答|1社記載<br>簡潔に回答|

### 1-2. 実験した時の動画
下記の動画がDifyのデバッグとプレビューの画面です。4つのgptモデルを並べて、同じプロンプトを一斉に流すことができます。動画は8秒以内で終わるので、0.25倍速で再生すると見やすいです。<br>

https://github.com/user-attachments/assets/2a60af8b-4480-4971-b37e-439c8d58a5c5

### 1-3. 回答内容の詳細
各モデルの回答内容を掲載します。

|gpt-4oの回答|
|:-----------|
|大和ハウス工業株式会社と株式会社トインクスの事例があります。<br>1. **大和ハウス工業株式会社**<br>   - **目的**: SharePoint Online上に構築された社内ポータルサイトの検索性向上。<br>   - **導入ツール**: Neuron Enterprise Search。<br>   - **効果**: 営業職・技術職・事務職など部門や職種を問わず、幅広い業務におけるシームレスな検索体験を実現。クラウドストレージへの移行に伴いデータの所在が分散したが、検索システムによってそれを意識することなく欲しい情報に辿り着けるようになった。<br>2. **株式会社トインクス**<br>   - **目的**: ファイルサーバのリプレイスをきっかけに企業内検索システムを導入。<br>   - **導入ツール**: Neuron Enterprise Search。<br>   - **効果**: ファイルサーバだけでなく、SharePoint Online上のファイルやポータルサイトの情報を素早く見つけ出せるようになり、業務効率化が促進された。<br>これらの事例は、SharePoint Onlineの検索性向上に成功した具体例として参考になります。<br>出典元ファイルのURL: [出典元ファイル](#)||

|gpt-4o-miniの回答|
|:-----------|
|SharePoint Onlineの検索に関する導入事例として、大和ハウス工業株式会社のケースがあります。彼らは「Neuron Enterprise Search」を導入し、社内ポータルサイトの検索性を向上させました。このシステムにより、営業職・技術職・事務職など、さまざまな部門でシームレスな検索体験を実現しています。<br>また、株式会社トインクスもファイルサーバのリプレイスをきっかけに企業内検索システムを導入し、SharePoint Onlineとの横断検索によって業務効率化を促進しました。<br>具体的なURLは提供できませんが、これらの事例を参考にしてみてください。|

|gpt-4の回答|
|:-----------|
|大和ハウス工業株式会社では、SharePoint Online上に構築された社内ポータルサイトの検索性向上を目的に「Neuron Enterprise Search」を導入しました。これにより、営業職、技術職、事務職など部門や職種を問わず、幅広い業務におけるシームレスな検索体験を実現しています。<br>また、株式会社トインクスでは、ファイルサーバのリプレイスをきっかけに企業内検索システムを導入し、SharePoint Onlineとの横断検索によって業務効率化が促進されました。|

|gpt-3.5-turboの回答|
|:-----------|
|SharePoint Onlineの検索の事例として、Neuron ESを導入した大和ハウス工業株式会社の事例があります。Neuron ESはSharePoint Online上に構築された社内ポータルサイトの検索性向上を目的に導入され、営業職・技術職・事務職など部門や職種を問わず、幅広い業務におけるシームレスな検索体験を実現しています。詳細は以下のURLから参照できます。<br>[Neuron ES導入事例 - 大和ハウス工業株式会社](URL)|

### 1-4. 料金に関する考察
今回利用した4つのgptモデルのカタログ価格は下記になります。価格は100万トークン当たりです。
[価格の参照先](https://azure.microsoft.com/ja-jp/pricing/details/cognitive-services/openai-service/):3月末現在
|モデル|モデルバージョン|Input|Output|
|----|----------|-------|-----|
|gpt-4o|2024-05-13|¥747.5|¥2,242.5|
|gpt-4o-mini|2024-07-18|¥22.4|¥89.7|
|gpt-4|Turbo 128K|¥1,495|¥4,485|
|gpt-35-turbo|0125 16K|¥74.7|¥224.2|

上記だと実際に利用した時の料金が分かりにくいので、1回質問して回答を得た時の各モデルのコストを参考として示します。<br>
コストは日本円で、小数点第3位を四捨五入しています。

|モデル|種類|コスト（日本円）|
|:---:|:--:|:---:|
|gpt-4-turbo128K|Inp-glbl|3.13|
|gpt-4-turbo128K|Outp-glbl|0.97|
|gpt 4o 0513|Input global|1.96|
|gpt 4o 0513|Output global|1.23|
|gpt-35-turbo-16K-0125|Input-regional|0.16|
|gpt-35-turbo-16K-0125|Output-regional|0.01|
|gpt-4o-mini-0718|Inp-glbl|0.03|
|gpt-4o-mini-0718|Outp-glbl|0.01|

InputとOutputを合計すると、下記のようになります。<br>
gpt-4(約４円/回) > gpt-4o(約3円/回) >> gpt-35-turbo(0.17円/回) > gpt-4o-mini(0.04円/回)<br>

上記のコストは、今回の実験のプロンプトとそれに対する回答内容の場合であって、他のパラメーターやプロンプトの内容によって変動します。<br>
今回の実験結果からは、回答の質とコストのどちらを重視するかを検討し、gpt-4o、もしくは、gpt-4o-miniの利用が良さそうです。<br>
その他の検討ポイントとして、セキュリティの観点からモデルの展開の種類が`global`か`regional`かを考慮する場合もあります。この点の詳細はAzure OpenAI Serviceの説明をご覧ください。

<br>
<br>

## 2. 追試
### 2-1. 最大チャンク長2000、オーバーラップ500のチャンク設定の場合
結果に大きな違いはありませんでした。<br>
gpt-4oの回答内容が箇条書きにならなかったですが、プロンプトで指示すれば箇条書きになります。<br>
<br>

### 2-2. プロンプトに指示を追加した場合
プロンプトに指示を追加した時の回答内容を確認しました。チャンク設定は、最大チャンク長512、オーバーラップ128としています。

|プロンプト|
|:-------|
|SharePoint Onlineの検索の事例を探してください。回答には目的と効果を入れてください。|

#### 2-2-1. 結果まとめ
プロンプトに対する回答内容としては、gpt-4oが詳細に回答しています。<br>
gpt-4o-miniが1社の回答になってしまいました。<br>
|モデル|gpt-4o|gpt-4o-mini|gpt-4|gpt-35-turbo|
|:----:|:-----:|:----------:|:----:|:------------:|
|回答内容|2社記載<br>詳細に回答|1社記載<br>簡潔に回答|社名記載無し<br>簡潔に回答|回答できず|

このように、プロンプトによって回答の質が変わってしまうことがあります。<br>
回答内容の詳細は下記をご覧ください。<br>


#### 2-2-2. 回答詳細
|gpt-4oの回答|
|:-----------|
|以下は、SharePoint Onlineの検索に関する導入事例です。<br>**事例1: 大和ハウス工業株式会社**<br>**目的:**<br>クラウドストレージ（SharePoint Online）への移行に伴い、データの所在が分散したため、検索システムによってそれを意識することなく欲しい情報に辿り着けるようにすること。<br>**効果:**<br>- 検索ストレスが低減し、業務効率が向上。<br>- 自社システムとのAPI連携により、従業員に新たな利用価値を創出。<br><br>**事例2: 株式会社トインクス**<br>**目的:**<br>ファイルサーバのリプレイスをきっかけに企業内検索システムを導入し、SharePoint Onlineとの横断検索によって業務効率化を促進すること。<br>**効果:**<br>- ファイルサーバだけでなく、SharePoint Online上のファイルやポータルサイトの情報を素早く見つけ出せるようになった。<br>- 利便性が高いツールであることから、自社利用だけではなく、グループ企業や他の企業への展開（販売）にも期待が持てる。<br>これらの事例は、SharePoint Onlineの検索機能を強化するために「Neuron ES」を導入し、業務効率化や情報共有の向上に成功した例です。|

|gpt-4o-miniの回答|
|:-----------|
|大和ハウス工業株式会社の事例があります。<br>**目的**: SharePoint Onlineの検索性を向上させるために、Neuron ESを導入しました。特に技術文書の検索に重きを置き、業務効率を改善することを目指しました。<br>**効果**: Neuron ESの導入により、検索ストレスが低減し、業務効率が向上しました。従業員はファイルサーバやSharePoint Online上の情報を素早く見つけ出せるようになり、全社で幅広く利用されるようになりました。また、自社システムとのAPI連携により、新たな利用価値も創出されました。<br>この事例は、全社的な「情報共有・連携」を密にするための取り組みの一環として行われました。|

|gpt-4の回答|
|:-----------|
|SharePoint Onlineの検索性向上のために「Neuron Enterprise Search」が導入された事例があります。この導入の目的は、社内ポータルサイト上での検索性を向上させることで、部門や職種を問わず幅広い業務においてシームレスな検索体験を実現することです。その効果としては、全社的な情報共有・連携を密にし、社内の情報伝達の強化やナレッジ共有を目的とした再編成を進めることが挙げられます。|

|gpt-3.5-turboの回答|
|:-----------|
|申し訳ありませんが、その情報は提供できません。他にお手伝いできることがあればお知らせください。|

<br>
<br>

## 3.番外編：PDFの文字化けについて
Difyでは、ナレッジとして追加できるファイル形式は、TXT, MARKDOWN, MDX, PDF, HTML, XLSX, XLS, DOCX, CSV, MD, HTMとなっており、pptxを追加できません。pdfをナレッジにする場合、Difyはpdfの操作や解析をPythonのライブラリであるpypdfium2で行います。pypdfium2は、Googleが提供するPDFiumライブラリに基づいています。今回の実験を通して、pypdfium2を使う場合、文字化けするpdfファイルがあることがわかりました。文字化けする例の画像を添付します。例えば、「SharePoint Online」が「㻿hare㻼oint 㻻nline」となっています。
<br><br>
<img alt="スクリーンショット 2025-03-21 21 53 35" src="https://github.com/user-attachments/assets/79905447-5950-4a18-9c1d-97421ae141c3" />
<br><br>
「㻿hare㻼oint 㻻nline」を例にすると、「SharePoint Online」で検索ができるものの、検索時のスコアは著しく低下し、回答精度に影響が出るようです。PowerPointから出力したpdfファイルはpypdfium2で処理しても文字化けしないことを確認しています。<br>
pypdfium2で文字化けするpdfファイルは、Azure AI Searchでは文字化けしていませんでした。また、同じファイルをApache PDFBoxでテキスト抽出したところ、文字化けはしませんでした。この現象は、ChromiumにIssueとして報告しています。ChromiumはGoogleが主導するオープンソースのウェブブラウザプロジェクトであり、Google Chromeの基盤となっています。<br>
AIの時代にはpdfの作り方やpdfを扱うライブラリにも配慮が必要になりそうです。詳しい報告は、別の機会にします。

<br>

[mainに戻る](https://github.com/brains-technology/sample-app-aoai-chatGPT/blob/branch-1/research/research_main.md)
